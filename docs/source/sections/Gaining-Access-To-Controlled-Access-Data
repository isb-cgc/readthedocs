************************************************
Accessing Controlled Data
************************************************

In ISB-CGC, you can gain access to `controlled data via personal user credentials <controlled-access/Controlled-data-Interactive.html>`_: 
  
  * Provides access to controlled data for 24 hours at a time;
  * Uses your *personal* credentials;
  * Example uses: the ISB-CGC Web App, R Studio or running short jobs on Google Compute Engine that complete in under 24 hours

Prerequisites
--------------

You'll need the following before requesting controlled access via ISB-CGC:

  * A Google identity;
  * An NIH or electronic Research Administration (eRA) account;
  * Database of Genotypes and Phenotypes (dbGaP) permission for each type of controlled access data of interest, linked to your NIH or eRA account;
  * Your Google identify `linked <controlled-access/Controlled-data-Interactive.html>`_ to your NIH/eRA account via the ISB-CGC Web App.

1) Google identity
++++++++++++++++++

If you don't have a Google identity yet, please see the  `ISB-CGC Quick-Start Guide <HowToGetStartedonISB-CGC.html>`_. 

2) NIH or eRA account
+++++++++++++++++++++

Intramural researchers can use their NIH log-in account, and extramural researchers will need to have a personal eRA account. Either way, the user's NIH/eRA
account needs to be affiliated with their institution's eRA account. Your principal investigator (PI) or other authorized person can create
your personal eRA account and link it to your institution's eRA account. 

If you already have an NIH/eRA account, you can log into eRA at `<https://public.era.nih.gov/commons>`_. 

  * If the Institution listed for you is not your current one, ask your PI to change it for you.
  * If you are the PI or other authorized person, you can create, link and update accounts from here.

Visit `electronic Research Administration (eRA) <http://era.nih.gov>`_ for more information on registering for a NIH eRA account.

3) Link your eRA (or NIH) account to dbGaP permissions.
++++++++++++++++++++++++++++++++++++++++++++++++++++++

Your principal investigator (PI) can link your NIH/eRA account to `dbGaP <http://dbgap.ncbi.nlm.nih.gov>`_ permissions for selected controlled access data sets. 

For more information on applying for dbGaP authorization to access controlled data, please see 
this dbGap How to Video: `Apply for Controlled Access Data <http://www.youtube.com/watch?v=-3tUBeKbP5c>`_.

For additional information, refer to `Tips for Preparing a Successful Data Access Request <https://www.ncbi.nlm.nih.gov/projects/gap/cgi-bin/GetPdf.cgi?document_name=GeneralAAInstructions.pdf>`_, 
and `Understanding Data Security <data/TCGA_Data_Security.html>`_.  Please be sure to review any pertinent Data Use Certification Agreements on dbGaP.

4) Link your NIH/eRA and Google identities.
+++++++++++++++++++++++++++++++++++++++++++

Before you can access *any* controlled-data hosted by the ISB-CGC, you must first associate your Google identity (which you use to sign in to the ISB-CGC Web App and
access the Google Cloud) with a valid NIH or eRA account associated with a dbGaP data-access request.

This is accomplished through the ISB-CGC Web App. Follow the directions on the  `How to link NIH/eRA and Google identities <controlled-access/Controlled-data-Interactive.html>`_ page.

During this process:
   
   * You will first be redirected to an NIH login page, and once you have successfully authenticated, ISB-CGC will store an association between your NIH/eRA identity and your Google identity. (Note that this should be a one-to-one association.)

   * Once you have authenticated, ISB-CGC will check which data sets (such as TCGA, TARGET controlled data, etc.) that you have been authorized (by dbGaP) to access. ISB-CGC obtains an updated whitelist for each of the hosted data sets from dbGaP every day.  If you have just recently been granted access by dbGaP, there may be a 24 hour delay before you will be able to request access to this data on ISB-CGC.

   * Once you have authenticated to NIH via the Web App, and your dbGaP authorization has been verified, the Google identity associated with your account will have access to the controlled data for 24 hours.

These prerequisite steps only need to be done once, unless your accounts become unlinked, you need access to another dbGaP controlled data set, or some other reason.

.. toctree::
   :maxdepth: 1
   :hidden:
   
   controlled-access/Controlled-data-Interactive


Controlled Access Via Personal User Credentials
-----------------------------------------------

The first time that you perform the above steps, you are automatically granted controlled access via your personal user credentials. This access lasts for 24 hours, though it can be extended. Subsequently, to obtain access, sign into the Web App, click on your persona (or **Account Details** on the drop down menu next to your name). Click the **Get Controlled Access** button below **Obtain controlled access for 24 hours**.

.. image:: controlled-access/DataAccess-24hours.png
   :align: center

   

